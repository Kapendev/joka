#!/bin/env sh

set -e
cd "$(dirname "$0")"

n=$1
[ -z "$n" ] && echo "Usage: run <count>" && exit

test() {
    echo "Testing: $1"
    time -p "$1" $n
    rm -f "$1" *.o
}

test_script() {
    echo "Testing: $2"
    time -p "$1" $2 $n
}

echo "Appending and removing $n items..."

ldc2 -O3 -i -I../../../source ./app_d.d
test ./app_d

rustc -O ./app_rs.rs
test ./app_rs

zig build-exe app_zig.zig -lc -O ReleaseFast
test ./app_zig

# NOTE: Added `-no-bounds-check` just to make some people happy.
odin build ./app_odin.odin -file -o:aggressive -no-bounds-check
test ./app_odin

#go build ./app_go.go
#test ./app_go

#test_script python3 ./app_py.py

echo 'Done!'
